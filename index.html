<!doctype html>
<html lang="ca">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="assets/logopet.png" type="image/x-icon">   
  <title>deFang · Gestió</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <img src="assets/logo.png" alt="deFang" class="logo">
    </div>
    <nav class="nav">
      <button class="nav-btn active" data-target="resum">Resum mensual</button>
      <button class="nav-btn" data-target="ingressos">Ingressos</button>
      <button class="nav-btn" data-target="despeses">Despeses</button>
    </nav>
<div class="header-month pretty">
  <button id="prevMonth" class="chip-nav" aria-label="Mes anterior">‹</button>
  <button id="activeMonthLabel" class="chip-month" type="button"></button>
  <input type="month" id="activeMonthPicker" />
  <button id="nextMonth" class="chip-nav" aria-label="Mes següent">›</button>
</div>


  </header>
<!-- Panell de login (mostra per defecte fins que hi ha sessió) -->
<section id="loginView" class="login-view">
  <div class="login-card">
    <h2>Accés privat</h2>
    <form id="loginForm" class="form">
      <div class="form-row">
        <label>Email</label>
        <input type="email" id="loginEmail" required autocomplete="username">
      </div>
      <div class="form-row">
        <label>Contrasenya</label>
        <input type="password" id="loginPassword" required autocomplete="current-password">
      </div>
      <button class="btn primary" type="submit">Entrar</button>
      <div id="loginError" class="hint" style="color:#c62828"></div>
    </form>
  </div>
</section>

  <main class="container">
    <!-- INGRESOS -->
    <section id="ingressos" class="view">
      <div class="section-header">
        <h2>Ingressos <span id="incomeChip" class="chip total">€0,00</span></h2>
        <div class="month-banner">Mes actiu: <strong id="monthIncomeText"></strong></div>
      </div>

      <div class="grid two">
        <div class="card">
          <h3>Afegir ingrés</h3>
          <form id="incomeForm" class="form">
            <div class="form-row">
              <label>Títol</label>
              <input type="text" id="incomeTitle" placeholder="Ex: Encàrrec personalitzat" required />
            </div>
            <div class="form-row">
              <label>Preu (€)</label>
              <input type="number" id="incomePrice" step="0.01" min="0" placeholder="0,00" required />
            </div>
            <div class="form-row">
              <label>Data</label>
              <input type="date" id="incomeDate" required />
            </div>
            <div class="form-row">
  <label>Mètode de pagament</label>
  <div class="chips" id="incomePayChips">
    <button type="button" class="chip opt" data-value="efectiu">Efectiu</button>
    <button type="button" class="chip opt selected" data-value="targeta">Targeta</button>
  </div>
  <input type="hidden" id="incomePay" value="targeta" />
</div>

            <div class="form-row">
              <label>Notes (opcional)</label>
              <textarea id="incomeNotes" rows="2" placeholder="Comentaris…"></textarea>
            </div>
<menu class="dialog-actions" style="display:flex;gap:8px;justify-content:flex-end;margin-top:4px">
  <button type="button" class="btn subtle" id="incomeCancelBtn" formnovalidate>Cancel·lar</button>
  <button class="btn primary" type="submit">Desar ingrés</button>
</menu>
              </form>
        </div>

        <div class="card">
          <div class="card-head">
            <h3>Plantilles d’ingressos</h3>
            <button class="btn subtle" id="openIncomeTpl">+ Nova plantilla</button>
          </div>
          <div id="incomeTplList" class="tpl-list"></div>
        </div>
      </div>

      <div class="card mt">
        <div class="card-head">
          <h3>Historial del mes</h3>
          <div class="kpis">
            <div class="kpi"><span>Total ingressos </span><strong id="incomeTotal">€0,00</strong></div>
          </div>
        </div>
        <div id="incomeTableWrap" class="table-wrap">
          <table class="table">
            <thead>
              <tr>
          <th>Data</th><th>Títol</th><th>Preu</th><th>Mètode</th><th>Notes</th><th></th>
              </tr>
            </thead>
            <tbody id="incomeTableBody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- DESPESES -->
    <section id="despeses" class="view">
      <div class="section-header">
        <h2>Despeses <span id="expenseChip" class="chip total">€0,00</span></h2>
        <div class="month-banner">Mes actiu: <strong id="monthExpenseText"></strong></div>
      </div>

      <div class="grid two">
        <div class="card">
          <h3>Afegir despesa</h3>
          <form id="expenseForm" class="form">
            <div class="form-row">
              <label>Concepte</label>
              <input type="text" id="expenseTitle" placeholder="Ex: Fang grogós 10kg" required />
            </div>
            <div class="form-row">
              <label>Import (€)</label>
              <input type="number" id="expensePrice" step="0.01" min="0" placeholder="0,00" required />
            </div>
            <div class="form-row">
              <label>Data</label>
              <input type="date" id="expenseDate" required />
            </div>
            <div class="form-row">
              <label>Notes (opcional)</label>
              <textarea id="expenseNotes" rows="2" placeholder="Comentaris…"></textarea>
            </div>
            <button class="btn primary" type="submit">Desar despesa</button>
          </form>
        </div>

        <div class="card">
          <div class="card-head">
            <h3>Plantilles de despeses</h3>
            <button class="btn subtle" id="openExpenseTpl">+ Nova plantilla</button>
          </div>
          <div id="expenseTplList" class="tpl-list"></div>
        </div>
      </div>

      <div class="card mt">
        <div class="card-head">
          <h3>Historial del mes</h3>
          <div class="kpis">
            <div class="kpi"><span>Total despeses </span><strong id="expenseTotal">€0,00</strong></div>
          </div>
        </div>
        <div id="expenseTableWrap" class="table-wrap">
          <table class="table">
            <thead>
              <tr>
                <th>Data</th><th>Concepte</th><th>Import</th><th>Notes</th><th></th>
              </tr>
            </thead>
            <tbody id="expenseTableBody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- RESUM -->
    <section id="resum" class="view show">
      <div class="section-header">
        <h2>Resum mensual</h2>
        <div class="actions-row">
          <div class="month-banner">Mes actiu: <strong id="monthSummaryText"></strong></div>
        </div>
      </div>

      <div class="grid three">
        <div class="card kpi-big">
          <span>Ingressos</span>
          <strong id="sumIncome">€0,00</strong>
        </div>
        <div class="card kpi-big">
          <span>Despeses</span>
          <strong id="sumExpense">€0,00</strong>
        </div>
        <div class="card kpi-big">
          <span>Balanç</span>
          <strong id="sumBalance">€0,00</strong>
        </div>
      </div>

      <div class="hint">El balanç és <em>ingressos − despeses</em>.</div>

      <div class="export-row">
          <span id="exportYearBadge" class="chip year"></span> <!-- AFEGIT -->

  <button class="btn primary" id="exportExcelBtn">Exportar Excel</button>
  <button class="btn primary" id="exportPdfBtn">Exportar PDF</button>
</div>
    </section>
  </main>

  <!-- Diàlegs -->
  <dialog id="tplDialog">
    <form method="dialog" id="tplForm" class="form">
      <h3 id="tplDialogTitle">Nova plantilla</h3>
      <div class="form-row">
        <label>Tipus</label>
        <select id="tplType" required>
          <option value="ingres">Ingrés</option>
          <option value="despesa">Despesa</option>
        </select>
      </div>
      <div class="form-row">
        <label>Nom</label>
        <input type="text" id="tplTitle" placeholder="Ex: Fang" required />
      </div>
      <div class="form-row">
        <label>Preu base (€)</label>
        <input type="number" id="tplPrice" step="0.01" min="0" placeholder="0,00" required />
      </div>
      <div class="form-row">
        <label>Imatge (opcional)</label>
        <input type="file" id="tplImage" accept="image/*" />
      </div>
      <menu class="dialog-actions">
<button class="btn subtle" id="cancelTplBtn" type="button">Cancel·lar</button>
        <button class="btn primary" id="saveTplBtn" value="default">Desar plantilla</button>
      </menu>
    </form>
  </dialog>

  <dialog id="useTplDialog">
    <form method="dialog" id="useTplForm" class="form">
      <h3 id="useTplTitle">Afegir des de plantilla</h3>
      <div class="form-row">
        <label>Preu (€)</label>
        <input type="number" id="useTplPrice" step="0.01" min="0" required />
      </div>
      <div class="form-row">
        <label>Data</label>
        <input type="date" id="useTplDate" required />
      </div>
      <menu class="dialog-actions">
        <button class="btn subtle" value="cancel">Cancel·lar</button>
        <button class="btn primary" id="confirmUseTpl" value="default">Afegir</button>
      </menu>
    </form>
  </dialog>

  <div id="toast"></div>
<button id="logoutBtn" class="fab-logout" title="Sortir">Log out</button>

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

  <!-- SheetJS per exportar Excel -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.1/dist/jspdf.plugin.autotable.min.js"></script>


  <script src="app.js"></script>
</body>
</html>
